<div class="actions-section">
  <h3>Actions coordinateur</h3>
  <div class="actions-grid">
    <div class="action-card" *ngFor="let secteur of secteurs">
      <div class="action-header">
        <i [ngClass]="secteur.icon" class="action-icon"></i>
        <span class="action-label">{{ secteur.label }}</span>
      </div>
      <div class="action-buttons">
        <button class="btn btn-outline-primary btn-sm me-2"
                [disabled]="actionInProgress[secteur.key + '_relancer']"
                (click)="askConfirmation(secteur.key, 'relancer')">
          <i class="bi bi-arrow-repeat"></i>
          <span *ngIf="!actionInProgress[secteur.key + '_relancer']">Relancer</span>
          <span *ngIf="actionInProgress[secteur.key + '_relancer']">
            <i class="bi bi-arrow-clockwise spin"></i> ...
          </span>
        </button>
        <button class="btn btn-outline-success btn-sm"
                [disabled]="actionInProgress[secteur.key + '_valider']"
                (click)="askConfirmation(secteur.key, 'valider')">
          <i class="bi bi-check2-circle"></i>
          <span *ngIf="!actionInProgress[secteur.key + '_valider']">Valider</span>
          <span *ngIf="actionInProgress[secteur.key + '_valider']">
            <i class="bi bi-arrow-clockwise spin"></i> ...
          </span>
        </button>
      </div>
    </div>
  </div>
  <div class="actions-history" *ngIf="actionsHistory.length > 0">
    <h4>Historique des actions</h4>
    <ul>
      <li *ngFor="let action of actionsHistory">
        <i [ngClass]="action.icon"></i>
        <span [ngClass]="{
          'text-primary': action.type === 'relancer',
          'text-success': action.type === 'valider'
        }">{{ action.label }}</span>
        <span class="text-muted ms-2">({{ action.date | date:'dd/MM/yyyy HH:mm:ss' }})</span>
      </li>
    </ul>
  </div>

  <!-- Confirmation Dialog -->
  <div class="confirm-dialog-backdrop" *ngIf="confirmDialog">
    <div class="confirm-dialog">
      <h5>Confirmation</h5>
      <p>
        Voulez-vous vraiment
        <strong>{{ confirmDialog.type === 'relancer' ? 'relancer' : 'valider' }}</strong>
        le secteur <strong>{{ getSecteurLabel(confirmDialog.secteur) }}</strong> ?
      </p>
      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary btn-sm" (click)="cancelAction()">Annuler</button>
        <button class="btn btn-primary btn-sm" (click)="confirmAction()">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Indicateurs stratégiques -->
  <div class="indicateurs-section mt-4">
    <h4>Indicateurs stratégiques</h4>
    <div class="indicateurs-grid">
      <div class="indicateur-card" *ngFor="let ind of indicateurs">
        <div class="indicateur-header">
          <i [ngClass]="ind.icon"></i>
          <span>{{ ind.label }}</span>
        </div>
        <div class="indicateur-value">
          <ng-container *ngIf="isCoordinateur; else valeurReadonly">
            <input type="number" min="0" max="100" [(ngModel)]="ind.value" class="form-control form-control-sm d-inline w-auto" style="width:70px;" /> %
          </ng-container>
          <ng-template #valeurReadonly>
            <span><strong>{{ ind.value }}%</strong></span>
          </ng-template>
        </div>
        <div class="indicateur-commentaire mt-1">
          <ng-container *ngIf="isCoordinateur; else commentaireReadonly">
            <input type="text" [(ngModel)]="ind.commentaire" class="form-control form-control-sm" placeholder="Commentaire..." />
          </ng-container>
          <ng-template #commentaireReadonly>
            <span>{{ ind.commentaire }}</span>
          </ng-template>
        </div>
        <button *ngIf="isCoordinateur" class="btn btn-outline-primary btn-sm mt-2" (click)="updateIndicateur(ind.key, ind.value, ind.commentaire)">
          <i class="bi bi-save"></i> Mettre à jour
        </button>
        <div class="indicateur-historique mt-2" *ngIf="ind.historique.length > 0">
          <strong>Historique :</strong>
          <ul>
            <li *ngFor="let h of ind.historique">
              <span class="text-muted">{{ h.date | date:'dd/MM/yyyy HH:mm' }}</span> -
              <span>{{ h.user }}</span> :
              <span><strong>{{ h.valeur }}%</strong></span>
              <span *ngIf="h.commentaire">({{ h.commentaire }})</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div> 